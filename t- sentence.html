<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WordWise - Sentence Connector</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --blue:#2dc4ff;
  --yellow:#fff59d;
  --ink:#00aaff;
  --dash:#2dc4ff;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:'Fredoka',sans-serif;
  background:repeating-linear-gradient(#fff,#fff 23px,var(--ink) 24px);
}
body::before{
  content:"";position:fixed;top:0;left:60px;width:2px;height:100%;background:#ffe873;z-index:0;
}
header{
  background:var(--blue);color:#fff;padding:15px 20px;
  position:fixed;left:0;right:0;top:0;z-index:2000;
  display:flex;align-items:center;justify-content:space-between;
}
header h2 {
  margin: 0;
  font-weight: 700;
  cursor: pointer;
  color: #fff;
}
nav a{color:#fff;text-decoration:none;font-weight:700;cursor:pointer;margin-left:15px;}
.section{padding:6rem 1rem 2rem;display:flex;flex-direction:column;align-items:center;text-align:center;min-height:100vh;}
h2{color:var(--blue);text-shadow:2px 3px #c9c9c9;margin-bottom:15px;font-size:2rem;}
.dash-panel{
  background:#fff;border:3px dashed var(--dash);border-radius:22px;
  padding:1.5rem;box-shadow:4px 6px #c9c9c9;text-align:center;width:min(700px,90%);
}
button{
  background:var(--yellow);border:none;border-radius:30px;
  padding:10px 20px;font-weight:700;font-size:1rem;color:var(--blue);cursor:pointer;margin:5px;
}
button:hover{filter:brightness(1.05);}
.word-bank,.sentence-box{
  display:flex;flex-wrap:wrap;justify-content:center;margin:10px 0;min-height:50px;
}
.word{
  background:var(--blue);color:#fff;margin:5px;padding:8px 15px;
  border-radius:20px;cursor:pointer;font-weight:600;transition:0.2s;
}
.word:hover{transform:scale(1.05);}
.box{
  border:2px dashed var(--dash);min-width:50px;min-height:40px;
  margin:5px;padding:8px 15px;border-radius:12px;display:flex;
  align-items:center;justify-content:center;background:#fafafa;
}
#confetti-canvas{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999;}
</style>
</head>
<body>
<canvas id="confetti-canvas"></canvas>

<header>
  <h2 onclick="window.location.href='index.html'">WORDWISE</h2>
  <div id="authLinks"></div>
</header>

<section class="section">
  <h2>Sentence Connector ‚è±Ô∏è</h2>
  <div class="dash-panel">
    <p><strong>Time Left:</strong> <span id="timer">--</span> seconds</p>
    <p><strong>Score:</strong> <span id="score">0</span></p>
    <h3 id="instruction">Choose Difficulty & Start!</h3>
    
    <!-- Difficulty buttons -->
    <div id="difficultySelect">
      <button onclick="startGame(60)">Easy (60s)</button>
      <button onclick="startGame(30)">Medium (30s)</button>
      <button onclick="startGame(20)">Hard (20s)</button>
    </div>

    <!-- Sentence building area -->
    <div class="sentence-box" id="sentenceBox"></div>
    <div class="word-bank" id="wordBank"></div>
    
    <div style="margin-top:1rem;">
      <button onclick="checkSentence()">‚úî Check Sentence</button>
      <button onclick="window.location.href='timed.html'">‚Üê Back to Timed Mode</button>
    </div>
  </div>
</section>

<script>
// ===== AUTH HEADER =====
function updateHeader() {
  const authLinks = document.getElementById("authLinks");
  const loggedInUser = localStorage.getItem("loggedInUser");
  if (loggedInUser) {
    authLinks.innerHTML = `
      <span style="font-weight:600;">Welcome, ${loggedInUser}</span>
      <button onclick="logout()">Logout</button>
    `;
  } else {
    window.location.href = "login.html";
  }
}
function logout(){
  localStorage.removeItem("loggedInUser");
  window.location.href="index.html";
}
document.addEventListener("DOMContentLoaded", updateHeader);

// ===== GAME LOGIC =====
const allSentences = [
  ["I","love","eating","apples"],
  ["The","cat","is","sleeping"],
  ["We","are","going","to","school"],
  ["She","likes","to","play","games"]
];

let remainingSentences = [];
let currentSentence = [];
let shuffled = [];
let score = 0;
let timeLeft = 0;
let timerInterval;

function shuffle(arr){
  return arr.sort(()=>Math.random()-0.5);
}

function startGame(duration){
  score = 0;
  timeLeft = duration;
  document.getElementById("score").textContent = score;
  document.getElementById("timer").textContent = timeLeft;
  document.getElementById("difficultySelect").style.display="none";

  // make a fresh copy of sentences for this round
  remainingSentences = shuffle([...allSentences]);

  nextRound();

  timerInterval = setInterval(()=>{
    timeLeft--;
    document.getElementById("timer").textContent = timeLeft;
    if(timeLeft<=0){endGame();}
  },1000);
}

function nextRound(){
  if(remainingSentences.length === 0){
    endGame();
    return;
  }

  currentSentence = remainingSentences.pop(); // take one sentence
  shuffled = shuffle([...currentSentence]);
  renderWords();
  document.getElementById("sentenceBox").innerHTML="";
  document.getElementById("instruction").textContent="Arrange the words to form a correct sentence!";
}

function renderWords(){
  const bank=document.getElementById("wordBank");
  bank.innerHTML="";
  shuffled.forEach(word=>{
    const span=document.createElement("span");
    span.className="word";
    span.textContent=word;
    span.onclick=()=>moveWord(span, "bank");
    bank.appendChild(span);
  });
}

function moveWord(span, from){
  if(from==="bank"){
    document.getElementById("sentenceBox").appendChild(span);
    span.onclick=()=>moveWord(span,"box");
  } else {
    document.getElementById("wordBank").appendChild(span);
    span.onclick=()=>moveWord(span,"bank");
  }
}

function checkSentence(){
  const attempt=[...document.getElementById("sentenceBox").children].map(x=>x.textContent);
  if(attempt.join(" ")===currentSentence.join(" ")){
    score+=2;
    document.getElementById("score").textContent=score;
    launchConfetti();
    nextRound();
  } else {
    document.getElementById("instruction").textContent="‚ùå Wrong, try again!";
  }
}

function endGame() {
  clearInterval(timerInterval);
  const finalScore = score;
  const user = localStorage.getItem("loggedInUser");

  if (user) {
    // üîπ Save high score for Sentence Connector (separate from Rapid Spelling)
    let prevHigh = parseInt(localStorage.getItem(`score_${user}_sentence`) || "0");
    if (finalScore > prevHigh) {
      localStorage.setItem(`score_${user}_sentence`, finalScore);
    }

    // üîπ Always update the user's main cumulative score
    let mainScore = parseInt(localStorage.getItem(`score_${user}`) || "0");
    mainScore += finalScore;
    localStorage.setItem(`score_${user}`, mainScore);
  }

  alert("‚úÖ Game Over! You scored " + finalScore);
  window.location.href = "timed.html"; // back to menu
}



// ===== CONFETTI =====
function launchConfetti(){
  const duration=0.8*1000,end=Date.now()+duration;
  (function frame(){
    confetti({particleCount:5,spread:70,origin:{y:0.6}});
    if(Date.now()<end){requestAnimationFrame(frame);}
  })();
}
var confettiScript=document.createElement("script");
confettiScript.src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js";
document.head.appendChild(confettiScript);
</script>

</body>
</html>
